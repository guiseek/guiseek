(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{dAjy:function(t,e,o){"use strict";o.r(e),o.d(e,"CallModule",function(){return L});var i=o("3Pt+"),n=o("ofXK"),c=o("tyNb"),s=o("0MNC"),a=o("NFeN"),r=(o("R1ws"),o("FKr1")),l=o("fXoL");let d=(()=>{class t{}return t.\u0275mod=l.Ib({type:t}),t.\u0275inj=l.Hb({factory:function(e){return new(e||t)},imports:[[r.d],r.d]}),t})();var h=o("qFsG"),g=o("rDax"),p=o("kmnG"),m=o("vxfF");o("u47x"),o("8LU1"),o("0EQZ"),o("FtGj"),o("XNiG"),o("NXyV"),o("VRyK"),o("JX91"),o("eIep"),o("IzEk"),o("pLZG"),o("lJxs"),o("/uUt"),o("1G5W"),o("R0Ic"),o("cH1L");const u={provide:new l.q("mat-select-scroll-strategy"),deps:[g.c],useFactory:function(t){return()=>t.scrollStrategies.reposition()}};let b=(()=>{class t{}return t.\u0275mod=l.Ib({type:t}),t.\u0275inj=l.Hb({factory:function(e){return new(e||t)},providers:[u],imports:[[n.c,g.f,r.h,r.d],m.b,p.d,r.h,r.d]}),t})();var f=o("GU7r");let C=(()=>{class t{}return t.\u0275mod=l.Ib({type:t}),t.\u0275inj=l.Hb({factory:function(e){return new(e||t)}}),t})(),S=(()=>{class t{}return t.\u0275mod=l.Ib({type:t}),t.\u0275inj=l.Hb({factory:function(e){return new(e||t)},imports:[[r.l,r.d,f.c,C],r.d,C]}),t})();var O=o("bTqV"),v=o("0IaG"),P=o("/t3+"),w=o("XhcP"),y=o("uN2N"),I=o("oaHY"),k=o("mrSG"),x=o("ZjB8"),M=o("fHwv"),V=o("gFX4");const E=["screenPoster"],_=["localVideo"],R=["remoteVideo"],j=function(t){return{connected:t}},D=[{path:"",component:(()=>{class t{constructor(t,e,o){this.config=t,this.dialog=e,this.logger=o,this.poster="assets/images/screen.svg",this.startTime=0,this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.getName=t=>t===this.pc1?"pc1":"pc2",this.getOtherPc=t=>t===this.pc1?this.pc2:this.pc1,this.gotStream=t=>{this.logger.log("Received local stream"),this.localVideo.srcObject=t,this.localStream=t},this.start=()=>Object(k.a)(this,void 0,void 0,function*(){this.logger.log("Requesting local stream");try{const t=yield Object(M.f)({audio:!0,video:!0});this.gotStream(t)}catch(t){alert("getUserMedia() error: "+t.name)}}),this.restart=()=>Object(k.a)(this,void 0,void 0,function*(){this.offerOptions.iceRestart=!0,this.logger.log("pc1 createOffer restart");try{const t=yield this.pc1.createOffer(this.offerOptions);this.onCreateOfferSuccess(t)}catch(t){this.onCreateSessionDescriptionError(t)}}),this.call=()=>{this.logger.log("Starting call"),this.startTime=window.performance.now();const t=this.localStream.getVideoTracks(),e=this.localStream.getAudioTracks();t.length>0&&this.logger.log("Using video device: "+t[0].label),e.length>0&&this.logger.log("Using audio device: "+e[0].label);const o={iceServers:[{urls:"stun:ubuntu.gui:3478"}]};this.pc1=this.pc1=new RTCPeerConnection(o),this.logger.log("Created local peer connection object pc1"),this.pc1.onicecandidate=t=>this.onIceCandidate(this.pc1,t),this.pc2=this.pc2=new RTCPeerConnection(o),this.logger.log("Created remote peer connection object pc2"),this.pc2.onicecandidate=t=>this.onIceCandidate(this.pc2,t),this.pc1.oniceconnectionstatechange=t=>{this.onIceStateChange(this.pc1,t)},this.pc2.oniceconnectionstatechange=t=>this.onIceStateChange(this.pc2,t),this.pc2.ontrack=this.gotRemoteStream,this.localStream.getTracks().forEach(t=>this.pc1.addTrack(t,this.localStream)),this.logger.log("Added local stream to pc1"),this.logger.log("pc1 createOffer start"),this.pc1.createOffer(this.offerOptions).then(this.onCreateOfferSuccess,this.onCreateSessionDescriptionError)},this.onCreateSessionDescriptionError=t=>{this.logger.log("Failed to create session description: "+t.toString())},this.onCreateOfferSuccess=t=>{this.logger.log("Offer from pc1\n"+t.sdp),this.logger.log("pc1 setLocalDescription start"),this.pc1.setLocalDescription(t).then(()=>this.onSetLocalSuccess(this.pc1),this.onSetSessionDescriptionError),this.logger.log("pc2 setRemoteDescription start"),this.pc2.setRemoteDescription(t).then(()=>this.onSetRemoteSuccess(this.pc2),this.onSetSessionDescriptionError),this.logger.log("pc2 createAnswer start"),this.pc2.createAnswer().then(this.onCreateAnswerSuccess,this.onCreateSessionDescriptionError)},this.onSetLocalSuccess=t=>{this.logger.log(this.getName(t)+" setLocalDescription complete")},this.onSetRemoteSuccess=t=>{this.logger.log(this.getName(t)+" setRemoteDescription complete")},this.onSetSessionDescriptionError=t=>{this.logger.log("Failed to set session description: "+t.toString())},this.gotRemoteStream=t=>{this.remoteVideo.srcObject!==t.streams[0]&&(this.remoteVideo.srcObject=t.streams[0],this.logger.log("pc2 received remote stream"))},this.onCreateAnswerSuccess=t=>{this.logger.log("Answer from pc2:\n"+t.sdp),this.logger.log("pc2 setLocalDescription start"),this.pc2.setLocalDescription(t).then(()=>this.onSetLocalSuccess(this.pc2),this.onSetSessionDescriptionError),this.logger.log("pc1 setRemoteDescription start"),this.pc1.setRemoteDescription(t).then(()=>this.onSetRemoteSuccess(this.pc1),this.onSetSessionDescriptionError)},this.onIceCandidate=(t,e)=>{this.getOtherPc(t).addIceCandidate(e.candidate).then(()=>this.onAddIceCandidateSuccess(t),e=>this.onAddIceCandidateError(t,e)),this.logger.log(`${this.getName(t)} ICE candidate:\n${e.candidate?e.candidate.candidate:"(null)"}`)},this.onAddIceCandidateSuccess=t=>{this.logger.log(this.getName(t)+" addIceCandidate success")},this.onAddIceCandidateError=(t,e)=>{this.logger.log(`${this.getName(t)} failed to add ICE Candidate: ${e.toString()}`)},this.onIceStateChange=(t,e)=>{t&&(this.logger.log(`${this.getName(t)} ICE state: ${t.iceConnectionState}`),this.logger.log("ICE state change event: ",e),"connected"!==t.iceConnectionState&&"completed"!==t.iceConnectionState||this.checkStats(t))},this.hangup=()=>{this.logger.log("Ending call"),this.pc1.close(),this.pc2.close(),this.pc1=null,this.pc2=null,this.localStream.getTracks().forEach(t=>t.stop())};const{socket:i}=this.config;this.socket=V.connect(i.uri),this.socket.on("connect",()=>{this.logger.log("Socket connected. I am",this.socket.id),this.peerId=this.socket.id}),this.socket.on("disconnect",({id:t})=>{this.logger.log("Socket disconnected. I was",t,this.socket.id)}),this.socket.on(M.c.Connected,({})=>this.call)}ngAfterViewInit(){console.log(this.localVideoRef),this.localVideo=this.localVideoRef.nativeElement,this.remoteVideo=this.remoteVideoRef.nativeElement,this.localVideo.addEventListener("loadedmetadata",({target:t})=>{this.logger.log(`Local video videoWidth: ${t.width}px,  videoHeight: ${t.height}px`)}),this.remoteVideo.addEventListener("loadedmetadata",({target:t})=>{this.logger.log(`Remote video videoWidth: ${t.width}px,  videoHeight: ${t.height}px`)}),this.remoteVideo.onresize=()=>{if(this.logger.log(`Remote video size changed to ${this.remoteVideo.videoWidth}x${this.remoteVideo.videoHeight}`),this.startTime){const t=window.performance.now()-this.startTime;this.logger.log("Setup time: "+t.toFixed(3)+"ms"),this.startTime=null,this.checkStats(this.pc1),this.checkStats(this.pc2)}}}checkStats(t){t.getStats(null).then(e=>{let o=null,i=null;e.forEach(t=>{"transport"===t.type&&(o=e.get(t.selectedCandidatePairId))}),o||e.forEach(t=>{"candidate-pair"===t.type&&"succeeded"===t.state&&t.selected&&(o=t)}),o&&o.remoteCandidateId&&e.forEach(t=>{"remote-candidate"===t.type&&t.id===o.remoteCandidateId&&(i=t)}),this.logger.log(i),i&&i.id&&(document.getElementById(t===this.pc1?"localCandidateId":"remoteCandidateId").textContent=i.id)})}}return t.\u0275fac=function(e){return new(e||t)(l.Kb(I.c),l.Kb(v.a),l.Kb(x.a))},t.\u0275cmp=l.Eb({type:t,selectors:[["sample-peer-call"]],viewQuery:function(t,e){if(1&t&&(l.yc(E,!0),l.yc(_,!0),l.yc(R,!0)),2&t){let t;l.ic(t=l.Xb())&&(e.screenPoster=t.first),l.ic(t=l.Xb())&&(e.localVideoRef=t.first),l.ic(t=l.Xb())&&(e.remoteVideoRef=t.first)}},decls:41,vars:20,consts:[[1,"example-container",3,"hasBackdrop"],["mode","over"],["drawer",""],["id","video"],["video",""],["id","localVideo","playsinline","","autoplay","","muted","",3,"ngClass"],["localVideo",""],["id","localCandidateId"],["localCandidateId",""],["id","remoteVideo","playsinline","","autoplay","","muted","",3,"ngClass"],["remoteVideo",""],["id","remoteCandidateId"],["remoteCandidateId",""],[1,"footer"],["mat-raised-button","",3,"click"],[1,"spacer"],["mat-button","","id","startButton",3,"disabled","click"],["id","callButton","mat-button","",3,"disabled","click"],["mat-button","","id","restartButton",3,"disabled","click"],["mat-button","","id","hangupButton",3,"disabled","click"]],template:function(t,e){if(1&t){const t=l.Qb();l.Pb(0,"mat-drawer-container",0),l.Pb(1,"mat-drawer",1,2),l.vc(3,"I'm a drawer"),l.Ob(),l.Pb(4,"mat-drawer-content"),l.Pb(5,"div",3,4),l.Pb(7,"figure"),l.Lb(8,"video",5,6),l.Pb(10,"caption",7,8),l.vc(12," Not connected. "),l.Ob(),l.Ob(),l.Pb(13,"figure"),l.Lb(14,"video",9,10),l.Pb(16,"caption",11,12),l.vc(18," Not connected. "),l.Ob(),l.Ob(),l.Ob(),l.Pb(19,"mat-toolbar",13),l.Pb(20,"button",14),l.Wb("click",function(){return l.lc(t),l.jc(2).toggle()}),l.vc(21,"Toggle drawer"),l.Ob(),l.Lb(22,"span",15),l.Pb(23,"pre"),l.vc(24),l.bc(25,"json"),l.Ob(),l.Pb(26,"pre"),l.vc(27),l.bc(28,"json"),l.Ob(),l.Pb(29,"pre"),l.vc(30),l.bc(31,"json"),l.Ob(),l.Lb(32,"span",15),l.Pb(33,"button",16),l.Wb("click",function(){return e.start()}),l.vc(34," Start "),l.Ob(),l.Pb(35,"button",17),l.Wb("click",function(){return e.call()}),l.vc(36," Call "),l.Ob(),l.Pb(37,"button",18),l.Wb("click",function(){return e.restart()}),l.vc(38," Restart ICE "),l.Ob(),l.Pb(39,"button",19),l.Wb("click",function(){return e.hangup()}),l.vc(40," Hang Up "),l.Ob(),l.Ob(),l.Ob(),l.Ob()}2&t&&(l.fc("hasBackdrop",!0),l.zb(8),l.fc("ngClass",l.hc(16,j,"connected"===(null==e.pc1?null:e.pc1.connectionState))),l.zb(6),l.fc("ngClass",l.hc(18,j,"connected"===(null==e.pc2?null:e.pc2.connectionState))),l.zb(10),l.wc(l.cc(25,10,null==e.pc1?null:e.pc1.connectionState)),l.zb(3),l.wc(l.cc(28,12,null==e.pc1?null:e.pc1.iceConnectionState)),l.zb(3),l.wc(l.cc(31,14,null==e.pc1?null:e.pc1.iceGatheringState)),l.zb(3),l.fc("disabled",null==e.localStream?null:e.localStream.active),l.zb(2),l.fc("disabled",!(null!=e.localStream&&e.localStream.active)||"connected"==(null==e.pc1?null:e.pc1.connectionState)),l.zb(2),l.fc("disabled","gathering"===(null==e.pc1?null:e.pc1.iceGatheringState)||"connected"!==(null==e.pc1?null:e.pc1.iceConnectionState)),l.zb(2),l.fc("disabled",!(null!=e.pc1&&e.pc1.connectionState)))},directives:[w.b,w.a,w.c,n.j,P.a,O.b],pipes:[n.f],styles:["[_nghost-%COMP%]{flex-direction:column}[_nghost-%COMP%], [_nghost-%COMP%]   .mat-drawer-container[_ngcontent-%COMP%]{display:flex;flex:1}[_nghost-%COMP%]   .mat-drawer[_ngcontent-%COMP%], [_nghost-%COMP%]   .mat-drawer-content[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .mat-drawer-content[_ngcontent-%COMP%]   .mat-toolbar[_ngcontent-%COMP%]{position:fixed;bottom:0}[_nghost-%COMP%]   .mat-drawer-content[_ngcontent-%COMP%]   #video[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}[_nghost-%COMP%]   .mat-drawer-content[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{background-color:rgba(33,33,33,.4588235294117647);max-height:calc(100vh - 64px)}[_nghost-%COMP%]   .mat-drawer-content[_ngcontent-%COMP%]   video#localVideo[_ngcontent-%COMP%]{max-width:320px;height:150px;position:fixed;right:calc(50% - 150px);bottom:calc(50% - 75px);transition:bottom 1s ease-in-out,right 1s ease-in-out .5s}[_nghost-%COMP%]   .mat-drawer-content[_ngcontent-%COMP%]   video#localVideo.connected[_ngcontent-%COMP%]{position:fixed;right:16px;bottom:80px}[_nghost-%COMP%]   .mat-drawer-content[_ngcontent-%COMP%]   video#remoteVideo[_ngcontent-%COMP%]{opacity:0;transition:opacity 2s ease-in-out,animation 2s ease-in-out .5s}[_nghost-%COMP%]   .mat-drawer-content[_ngcontent-%COMP%]   video#remoteVideo.connected[_ngcontent-%COMP%]{opacity:1;animation:fade-in-tl 1.6s cubic-bezier(.39,.575,.565,1) both}@keyframes fade-in-tl{0%{transform:translateX(-50px) translateY(-50px);opacity:0}to{transform:translateX(0) translateY(0);opacity:1}}"]}),t})()}];let L=(()=>{class t{}return t.\u0275mod=l.Ib({type:t}),t.\u0275inj=l.Hb({factory:function(e){return new(e||t)},imports:[[s.c,a.b,d,h.b,O.c,b,w.d,v.b,P.b,S,p.d,I.d,y.a,n.c,i.h,c.b.forChild(D)]]}),t})()}}]);