(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"3n1L":function(t,e,o){"use strict";o.r(e),o.d(e,"LabsModule",function(){return M});var i=o("ofXK"),c=o("tyNb"),n=o("NFeN"),s=o("kmnG"),a=o("qFsG"),r=o("bTqV"),l=o("/t3+"),d=o("XhcP"),h=o("0IaG"),g=o("STbY"),p=o("fXoL");const b=["drawer"];let u=(()=>{class t{constructor(){}onActivate(t){t.drawer$.subscribe(t=>{this.drawer&&this.drawer.toggle(),console.log("ahahaha: ",t)})}ngAfterViewInit(){console.log(this.drawer)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Eb({type:t,selectors:[["sample-peer-labs"]],viewQuery:function(t,e){if(1&t&&p.yc(b,!0),2&t){let t;p.ic(t=p.Xb())&&(e.drawer=t.first)}},decls:6,vars:1,consts:[[1,"labs-container",3,"hasBackdrop"],[3,"activate"],["position","end","mode","over"],["drawer",""]],template:function(t,e){1&t&&(p.Pb(0,"mat-drawer-container",0),p.Pb(1,"mat-drawer-content"),p.Pb(2,"router-outlet",1),p.Wb("activate",function(t){return e.onActivate(t)}),p.Ob(),p.Ob(),p.Pb(3,"mat-drawer",2,3),p.vc(5,"I'm a drawer"),p.Ob(),p.Ob()),2&t&&p.fc("hasBackdrop",!0)},directives:[d.b,d.c,c.c,d.a],styles:["[_nghost-%COMP%]{flex-direction:column}[_nghost-%COMP%], [_nghost-%COMP%]   .mat-drawer-container[_ngcontent-%COMP%]{display:flex;flex:1}[_nghost-%COMP%]   .mat-drawer[_ngcontent-%COMP%], [_nghost-%COMP%]   .mat-drawer-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}"]}),t})();var m=o("mrSG"),f=o("ZjB8"),C=o("fHwv"),S=o("gFX4"),v=o("oaHY"),O=o("2Vo4"),P=o("3Pt+");const w=["screenPoster"],k=["localVideo"],y=["remoteVideo"],I=function(t){return{connected:t}};let x=(()=>{class t{constructor(t,e,o){this.config=t,this.dialog=e,this.logger=o,this.drawer=new O.a(!1),this.drawer$=this.drawer.asObservable(),this.state=new P.b({}),this.poster="assets/images/screen.svg",this.startTime=0,this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.getName=t=>t===this.pc1?"pc1":"pc2",this.getOtherPc=t=>t===this.pc1?this.pc2:this.pc1,this.gotStream=t=>{this.logger.log("Received local stream"),this.localVideo.srcObject=t,this.localStream=t},this.start=()=>Object(m.a)(this,void 0,void 0,function*(){this.logger.log("Requesting local stream");try{const t=yield Object(C.f)({audio:!0,video:!0});this.gotStream(t)}catch(t){alert("getUserMedia() error: "+t.name)}}),this.restart=()=>Object(m.a)(this,void 0,void 0,function*(){this.offerOptions.iceRestart=!0,this.logger.log("pc1 createOffer restart");try{const t=yield this.pc1.createOffer(this.offerOptions);this.onCreateOfferSuccess(t)}catch(t){this.onCreateSessionDescriptionError(t)}}),this.call=()=>{this.logger.log("Starting call"),this.startTime=window.performance.now();const t=this.localStream.getVideoTracks(),e=this.localStream.getAudioTracks();t.length>0&&this.logger.log("Using video device: "+t[0].label),e.length>0&&this.logger.log("Using audio device: "+e[0].label);const o={iceServers:[{urls:"stun:ubuntu.gui:3478"}]};this.pc1=this.pc1=new RTCPeerConnection(o),this.logger.log("Created local peer connection object pc1"),this.pc1.onicecandidate=t=>this.onIceCandidate(this.pc1,t),this.pc2=this.pc2=new RTCPeerConnection(o),this.logger.log("Created remote peer connection object pc2"),this.pc2.onicecandidate=t=>this.onIceCandidate(this.pc2,t),this.pc1.oniceconnectionstatechange=t=>{this.onIceStateChange(this.pc1,t)},this.pc2.oniceconnectionstatechange=t=>this.onIceStateChange(this.pc2,t),this.pc2.ontrack=this.gotRemoteStream,this.localStream.getTracks().forEach(t=>this.pc1.addTrack(t,this.localStream)),this.logger.log("Added local stream to pc1"),this.logger.log("pc1 createOffer start"),this.pc1.createOffer(this.offerOptions).then(this.onCreateOfferSuccess,this.onCreateSessionDescriptionError)},this.onCreateSessionDescriptionError=t=>{this.logger.log("Failed to create session description: "+t.toString())},this.onCreateOfferSuccess=t=>{this.logger.log("Offer from pc1\n"+t.sdp),this.logger.log("pc1 setLocalDescription start"),this.pc1.setLocalDescription(t).then(()=>this.onSetLocalSuccess(this.pc1),this.onSetSessionDescriptionError),this.logger.log("pc2 setRemoteDescription start"),this.pc2.setRemoteDescription(t).then(()=>this.onSetRemoteSuccess(this.pc2),this.onSetSessionDescriptionError),this.logger.log("pc2 createAnswer start"),this.pc2.createAnswer().then(this.onCreateAnswerSuccess,this.onCreateSessionDescriptionError)},this.onSetLocalSuccess=t=>{this.logger.log(this.getName(t)+" setLocalDescription complete")},this.onSetRemoteSuccess=t=>{this.logger.log(this.getName(t)+" setRemoteDescription complete")},this.onSetSessionDescriptionError=t=>{this.logger.log("Failed to set session description: "+t.toString())},this.gotRemoteStream=t=>{this.remoteVideo.srcObject!==t.streams[0]&&(this.remoteVideo.srcObject=t.streams[0],this.logger.log("pc2 received remote stream"))},this.onCreateAnswerSuccess=t=>{this.logger.log("Answer from pc2:\n"+t.sdp),this.logger.log("pc2 setLocalDescription start"),this.pc2.setLocalDescription(t).then(()=>this.onSetLocalSuccess(this.pc2),this.onSetSessionDescriptionError),this.logger.log("pc1 setRemoteDescription start"),this.pc1.setRemoteDescription(t).then(()=>this.onSetRemoteSuccess(this.pc1),this.onSetSessionDescriptionError)},this.onIceCandidate=(t,e)=>{this.getOtherPc(t).addIceCandidate(e.candidate).then(()=>this.onAddIceCandidateSuccess(t),e=>this.onAddIceCandidateError(t,e)),this.logger.log(`${this.getName(t)} ICE candidate:\n${e.candidate?e.candidate.candidate:"(null)"}`)},this.onAddIceCandidateSuccess=t=>{this.logger.log(this.getName(t)+" addIceCandidate success")},this.onAddIceCandidateError=(t,e)=>{this.logger.log(`${this.getName(t)} failed to add ICE Candidate: ${e.toString()}`)},this.onIceStateChange=(t,e)=>{t&&(this.logger.log(`${this.getName(t)} ICE state: ${t.iceConnectionState}`),this.logger.log("ICE state change event: ",e),"connected"!==t.iceConnectionState&&"completed"!==t.iceConnectionState||this.checkStats(t))},this.hangup=()=>{this.logger.log("Ending call"),this.pc1.close(),this.pc2.close(),this.pc1=null,this.pc2=null,this.localStream.getTracks().forEach(t=>t.stop())};const{socket:i}=this.config;this.socket=S.connect(i.uri),this.socket.on("connect",()=>{this.logger.log("Socket connected. I am",this.socket.id),this.peerId=this.socket.id}),this.socket.on("disconnect",({id:t})=>{this.logger.log("Socket disconnected. I was",t,this.socket.id)}),this.socket.on(C.c.Connected,({})=>this.call)}drawerToggle(){this.drawer.next(!this.drawer.value)}ngAfterViewInit(){console.log(this.localVideoRef),this.localVideo=this.localVideoRef.nativeElement,this.remoteVideo=this.remoteVideoRef.nativeElement,this.localVideo.addEventListener("loadedmetadata",({target:t})=>{this.logger.log(`Local video videoWidth: ${t.width}px,  videoHeight: ${t.height}px`)}),this.remoteVideo.addEventListener("loadedmetadata",({target:t})=>{this.logger.log(`Remote video videoWidth: ${t.width}px,  videoHeight: ${t.height}px`)}),this.remoteVideo.onresize=()=>{if(this.logger.log(`Remote video size changed to ${this.remoteVideo.videoWidth}x${this.remoteVideo.videoHeight}`),this.startTime){const t=window.performance.now()-this.startTime;this.logger.log("Setup time: "+t.toFixed(3)+"ms"),this.startTime=null,this.checkStats(this.pc1),this.checkStats(this.pc2)}}}checkStats(t){t.getStats(null).then(e=>{let o=null,i=null;e.forEach(t=>{"transport"===t.type&&(o=e.get(t.selectedCandidatePairId))}),o||e.forEach(t=>{"candidate-pair"===t.type&&"succeeded"===t.state&&t.selected&&(o=t)}),o&&o.remoteCandidateId&&e.forEach(t=>{"remote-candidate"===t.type&&t.id===o.remoteCandidateId&&(i=t)}),this.logger.log(i),i&&i.id&&(document.getElementById(t===this.pc1?"localCandidateId":"remoteCandidateId").textContent=i.id)})}}return t.\u0275fac=function(e){return new(e||t)(p.Kb(v.c),p.Kb(h.a),p.Kb(f.a))},t.\u0275cmp=p.Eb({type:t,selectors:[["sample-peer-restart-ice"]],viewQuery:function(t,e){if(1&t&&(p.yc(w,!0),p.yc(k,!0),p.yc(y,!0)),2&t){let t;p.ic(t=p.Xb())&&(e.screenPoster=t.first),p.ic(t=p.Xb())&&(e.localVideoRef=t.first),p.ic(t=p.Xb())&&(e.remoteVideoRef=t.first)}},decls:44,vars:13,consts:[["id","video"],["video",""],["id","localVideo","playsinline","","autoplay","","muted","",3,"ngClass"],["localVideo",""],["id","localCandidateId"],["localCandidateId",""],["id","remoteVideo","playsinline","","autoplay","","muted","",3,"ngClass"],["remoteVideo",""],["id","remoteCandidateId"],["remoteCandidateId",""],["color","primary",1,"footer"],["mat-raised-button","",3,"click"],[1,"spacer"],["type","text","matInput","",3,"value"],[1,"mat-hint"],["mat-button","","id","startButton",3,"disabled","click"],["id","callButton","mat-button","",3,"disabled","click"],["mat-button","","id","restartButton",3,"disabled","click"],["mat-button","","id","hangupButton",3,"disabled","click"]],template:function(t,e){1&t&&(p.Pb(0,"section",0,1),p.Pb(2,"figure"),p.Lb(3,"video",2,3),p.Pb(5,"caption",4,5),p.vc(7," Not connected. "),p.Ob(),p.Ob(),p.Pb(8,"figure"),p.Lb(9,"video",6,7),p.Pb(11,"caption",8,9),p.vc(13," Not connected. "),p.Ob(),p.Ob(),p.Ob(),p.Pb(14,"mat-toolbar",10),p.Pb(15,"button",11),p.Wb("click",function(){return e.drawerToggle()}),p.vc(16,"Toggle drawer"),p.Ob(),p.Lb(17,"span",12),p.Pb(18,"mat-form-field"),p.Pb(19,"mat-label"),p.vc(20,"Connection State"),p.Ob(),p.Lb(21,"input",13),p.Ob(),p.Lb(22,"span",12),p.Pb(23,"div"),p.Pb(24,"small",14),p.vc(25,"Ice Connection State: "),p.Ob(),p.Pb(26,"code"),p.vc(27),p.Ob(),p.Ob(),p.Lb(28,"span",12),p.Pb(29,"div"),p.Pb(30,"div"),p.Pb(31,"small",14),p.vc(32,"Ice Gathering State"),p.Ob(),p.Ob(),p.Pb(33,"code"),p.vc(34),p.Ob(),p.Ob(),p.Lb(35,"span",12),p.Pb(36,"button",15),p.Wb("click",function(){return e.start()}),p.vc(37," Preparar "),p.Ob(),p.Pb(38,"button",16),p.Wb("click",function(){return e.call()}),p.vc(39," Ligar "),p.Ob(),p.Pb(40,"button",17),p.Wb("click",function(){return e.restart()}),p.vc(41," Re-negociar "),p.Ob(),p.Pb(42,"button",18),p.Wb("click",function(){return e.hangup()}),p.vc(43," Desligar "),p.Ob(),p.Ob()),2&t&&(p.zb(3),p.fc("ngClass",p.hc(9,I,"connected"===(null==e.pc1?null:e.pc1.connectionState))),p.zb(6),p.fc("ngClass",p.hc(11,I,"connected"===(null==e.pc2?null:e.pc2.connectionState))),p.zb(12),p.fc("value",null==e.pc1?null:e.pc1.connectionState),p.zb(6),p.wc(null==e.pc1?null:e.pc1.iceConnectionState),p.zb(7),p.wc(null==e.pc1?null:e.pc1.iceGatheringState),p.zb(2),p.fc("disabled",null==e.localStream?null:e.localStream.active),p.zb(2),p.fc("disabled",!(null!=e.localStream&&e.localStream.active)||"connected"==(null==e.pc1?null:e.pc1.connectionState)),p.zb(2),p.fc("disabled","gathering"===(null==e.pc1?null:e.pc1.iceGatheringState)||"connected"!==(null==e.pc1?null:e.pc1.iceConnectionState)),p.zb(2),p.fc("disabled",!(null!=e.pc1&&e.pc1.connectionState)))},directives:[i.j,l.a,r.b,s.b,s.e,a.a],styles:["[_nghost-%COMP%], [_nghost-%COMP%]   #video[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}[_nghost-%COMP%]   #video[_ngcontent-%COMP%]{align-items:center;justify-content:center}[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%]{position:fixed;bottom:0}[_nghost-%COMP%]   video[_ngcontent-%COMP%]{background-color:rgba(33,33,33,.4588235294117647);max-height:calc(100vh - 64px)}[_nghost-%COMP%]   video#localVideo[_ngcontent-%COMP%]{max-width:320px;height:150px;position:fixed;right:calc(50% - 150px);bottom:calc(50% - 75px);transition:bottom 1s ease-in-out,right 1s ease-in-out .5s}[_nghost-%COMP%]   video#localVideo.connected[_ngcontent-%COMP%]{position:fixed;right:16px;bottom:80px}[_nghost-%COMP%]   video#remoteVideo[_ngcontent-%COMP%]{opacity:0;transition:opacity 2s ease-in-out,animation 2s ease-in-out .5s}[_nghost-%COMP%]   video#remoteVideo.connected[_ngcontent-%COMP%]{opacity:1;animation:fade-in-tl 1.6s cubic-bezier(.39,.575,.565,1) both}@keyframes fade-in-tl{0%{transform:translateX(-50px) translateY(-50px);opacity:0}to{transform:translateX(0) translateY(0);opacity:1}}"]}),t})();var V=o("uN2N");const E=[{path:"",component:u,children:[{path:"ice-restart",component:x}]}];let M=(()=>{class t{}return t.\u0275mod=p.Ib({type:t}),t.\u0275inj=p.Hb({factory:function(e){return new(e||t)},imports:[[i.c,h.b,s.d,a.b,n.b,r.c,d.d,l.b,g.c,V.a,c.b.forChild(E)]]}),t})()}}]);